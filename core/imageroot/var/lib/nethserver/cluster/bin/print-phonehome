#!/usr/bin/env python3

#
# Copyright (C) 2025 Nethesis S.r.l.
# SPDX-License-Identifier: AGPL-3.0-or-later
#

'''
Helper script that retrieve cluster infor for the phonehome server.
'''

import sys
import json
import agent
from cluster import inventory

facts = inventory.cluster_facts()
if facts:
    facts['facts']['modules'] = inventory.modules_facts()
    facts['facts']['cluster'] = {}
    facts['facts']['cluster']['subscription'] = inventory.fact_subscription()
    facts['facts']['cluster']['admins'] = inventory.fact_admins()
    facts['facts']['cluster']['repositories'] = inventory.fact_repositories()
    facts['facts']['cluster']['smarthost'] = inventory.fact_smarthost()
else:
    print(agent.SD_ERR + f"phonehome failed", file=sys.stderr)
    sys.exit(1)

print(json.dumps(facts))